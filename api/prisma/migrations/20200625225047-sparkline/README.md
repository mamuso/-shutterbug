# Migration `20200625225047-sparkline`

This migration has been generated by Manuel Mu√±oz Solera at 6/25/2020, 10:50:47 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Sparkline" (
"data" text []  ,"deviceId" text  NOT NULL ,"id" text  NOT NULL ,"pageId" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Capture" ADD COLUMN "sparklineId" text   ;

ALTER TABLE "public"."Sparkline" ADD FOREIGN KEY ("deviceId")REFERENCES "public"."Device"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Sparkline" ADD FOREIGN KEY ("pageId")REFERENCES "public"."Page"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Capture" ADD FOREIGN KEY ("sparklineId")REFERENCES "public"."Sparkline"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200426120442-device-scale-factor..20200625225047-sparkline
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -40,20 +40,32 @@
   createdAt         DateTime  @default(now())
 }
 model Capture {
-  id                String   @default(cuid()) @id
-  slug              String   @unique
+  id                String      @default(cuid()) @id
+  slug              String      @unique
   url               String?
   urlmin            String?
   urldiff           String?
-  diff              Boolean  @default(false)
+  diff              Boolean     @default(false)
   diffindex         Float?
   deviceScaleFactor Int?
-  page              Page     @relation(fields: [pageId], references: [id])
+  page              Page        @relation(fields: [pageId], references: [id])
   pageId            String
-  report            Report   @relation(fields: [reportId], references: [id])
+  report            Report      @relation(fields: [reportId], references: [id])
   reportId          String
-  device            Device   @relation(fields: [deviceId], references: [id])
+  device            Device      @relation(fields: [deviceId], references: [id])
   deviceId          String
-  createdAt         DateTime @default(now())
+  sparkline         Sparkline?  @relation(fields: [sparklineId], references: [id])
+  sparklineId       String?
+  createdAt         DateTime    @default(now())
+}
+
+model Sparkline {
+  id              String    @default(cuid()) @id
+  device          Device    @relation(fields: [deviceId], references: [id])
+  deviceId        String
+  page            Page      @relation(fields: [pageId], references: [id])
+  pageId          String
+  captures        Capture[]
+  data            String[]
 }
```


